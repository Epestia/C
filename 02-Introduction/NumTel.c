#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <regex.h>

// Fonction pour vérifier si une chaîne correspond à une regex donnée
int match_regex(const char *string, const char *pattern) {
    regex_t regex;
    int ret;

    // Compile le pattern en regex
    ret = regcomp(&regex, pattern, REG_EXTENDED);
    if (ret) {
        fprintf(stderr, "Could not compile regex\n");
        return 0;
    }

    // Exécute la regex sur la chaîne donnée
    ret = regexec(&regex, string, 0, NULL, 0);
    regfree(&regex);

    // Retourne 1 si la chaîne correspond, sinon 0
    return !ret;
}

int main() {
    char phone_number[100];
    printf("Entrez le numéro de téléphone à vérifier: ");
    scanf("%s", phone_number);

    // Définir les regex pour les pays de l'UE
    const char *patterns[] = {
        // Belgique: +32 123 45 67 89 ou 012 34 56 78
        "^\\+32[ -.]?[0-9]{1,2}[ -.]?[0-9]{3}[ -.]?[0-9]{2}[ -.]?[0-9]{2}$",
        "^0[1-9][ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}$",
        // Allemagne: +49 1234 567890 ou 01234 567890
        "^\\+49[ -.]?[0-9]{1,4}[ -.]?[0-9]{2,4}[ -.]?[0-9]{4}$",
        "^0[1-9][0-9]{2,3}[ -.]?[0-9]{4,6}$",
        // Luxembourg: +352 1234 5678 ou 1234 5678
        "^\\+352[ -.]?[0-9]{4,6}[ -.]?[0-9]{4}$",
        "^[0-9]{4,6}[ -.]?[0-9]{4}$",
        // France: +33 1 23 45 67 89 ou 01 23 45 67 89
        "^\\+33[ -.]?[0-9]{1}?[ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}$",
        "^0[1-9][ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}$",
        // Italie: +39 123 456 7890 ou 012 345 6789
        "^\\+39[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Espagne: +34 123 456 789 ou 012 345 678
        "^\\+34[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Pays-Bas: +31 123 456 7890 ou 012 345 6789
        "^\\+31[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        // Pologne: +48 123 456 789 ou 012 345 678
        "^\\+48[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Roumanie: +40 123 456 789 ou 012 345 678
        "^\\+40[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Grèce: +30 123 456 7890 ou 012 345 6789
        "^\\+30[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        // Hongrie: +36 123 456 789 ou 012 345 678
        "^\\+36[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Irlande: +353 123 456 789 ou 012 345 6789
        "^\\+353[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Autriche: +43 123 456 7890 ou 012 345 6789
        "^\\+43[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        // Bulgarie: +359 123 456 789 ou 012 345 678
        "^\\+359[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Croatie: +385 123 456 789 ou 012 345 678
        "^\\+385[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Danemark: +45 12 34 56 78 ou 12345678
        "^\\+45[ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}[ -.]?[0-9]{2}$",
        "^[0-9]{8}$",
        // Estonie: +372 123 4567 ou 1234567
        "^\\+372[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^[0-9]{7}$",
        // Finlande: +358 123 4567890 ou 0123 456 789
        "^\\+358[ -.]?[0-9]{3}[ -.]?[0-9]{6,7}$",
        "^0[1-9][0-9]{2}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Lettonie: +371 123 4567 ou 1234567
        "^\\+371[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^[0-9]{7}$",
        // Lituanie: +370 123 45678 ou 12345678
        "^\\+370[ -.]?[0-9]{3}[ -.]?[0-9]{5}$",
        "^[0-9]{8}$",
        // Malte: +356 1234 5678 ou 12345678
        "^\\+356[ -.]?[0-9]{4}[ -.]?[0-9]{4}$",
        "^[0-9]{8}$",
        // Portugal: +351 123 456 789 ou 123 456 789
        "^\\+351[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Slovénie: +386 12 345 678 ou 012 345 678
        "^\\+386[ -.]?[0-9]{2}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{2}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Slovaquie: +421 123 456 789 ou 0123 456 789
        "^\\+421[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Suède: +46 123 456 7890 ou 0123 456 789
        "^\\+46[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{4}$",
        "^0[1-9][ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // Chypre: +357 12 345 678 ou 123 456 789
        "^\\+357[ -.]?[0-9]{2}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^[0-9]{2}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        // République Tchèque: +420 123 456 789 ou 123 456 789
        "^\\+420[ -.]?[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$",
        "^[0-9]{3}[ -.]?[0-9]{3}[ -.]?[0-9]{3}$"
    };

    // Vérifie le numéro de téléphone contre chaque regex
    int valid = 0;
    for (int i = 0; i < sizeof(patterns)/sizeof(patterns[0]); i++) {
        if (match_regex(phone_number, patterns[i])) {
            valid = 1;
            break;
        }
    }

    if (valid) {
        printf("Numéro de téléphone valide.\n");
    } else {
        printf("Numéro de téléphone invalide.\n");
    }

    return 0;
}
